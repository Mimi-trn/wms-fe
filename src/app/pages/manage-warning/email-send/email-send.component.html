<nz-row nzAlign="middle" class="mb-12">
  <app-breadcrumb
    nz-col
    [nzSpan]="24"
    [listBreadCrumb]="breadcrumbs"
    [isHidden]="false"
  ></app-breadcrumb>
</nz-row>

<div class="common-bg">
  <nz-row nzJustify="center" class="mb-12">
    <h2 class="m-0">
      {{ "Quản lý cấu hình email nhận thông báo" | translate }}
    </h2>
  </nz-row>

  <nz-row class="mb-12">
    <nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24" nzXXl="24">
      <h4 class="m-0">{{ "search.general" | translate }}</h4>
    </nz-col>
    <nz-col nzXs="24" nzSm="24" nzMd="14" nzLg="12" nzXl="10" nzXXl="6">
      <form (ngSubmit)="searchGeneralFunc()">
        <nz-input-group
          [nzPrefix]="prefixButtonSearch"
          [nzSuffix]="suffixButtonClear"
        >
          <input
            type="text"
            nz-input
            placeholder="{{ 'search.general.placeholder' | translate }}"
            [(ngModel)]="searchGeneral"
            name="searchGeneral"
          />
        </nz-input-group>
        <ng-template #prefixButtonSearch>
          <span
            class="search-click"
            style="color: #d9d9d9"
            nz-icon
            nzType="search"
            (click)="searchGeneralFunc()"
          ></span>
        </ng-template>
        <ng-template #suffixButtonClear>
          <span
            nz-icon
            class="ant-input-clear-icon"
            nzTheme="fill"
            nzType="close-circle"
            *ngIf="searchGeneral"
            (click)="searchGeneral = ''"
          ></span>
        </ng-template>
      </form>
    </nz-col>
  </nz-row>
  <nz-row nzAlign="middle" nzJustify="end" nzGutter="12" class="mb-12">
    <nz-col>
      <button
        nz-button
        nzType="text"
        class="p-0"
        nz-tooltip
        nz-dropdown
        [nzDropdownMenu]="configColumns"
      >
        <img src="./../../../../assets/image/addColumn.svg" alt="" />
        <nz-dropdown-menu #configColumns="nzDropdownMenu">
          <div
            style="
              background-color: white;
              padding: 8px 12px;
              border: 1px solid #ccc;
            "
          >
            <ng-container>
              <label
                class="mb-4"
                nz-checkbox
                [(ngModel)]="allChecked"
                (ngModelChange)="updateAllChecked()"
                [nzIndeterminate]="indeterminated"
              >
                Tất cả
              </label>
              <br />
            </ng-container>
            <ng-container *ngFor="let column of columns; let i = index">
              <label
                class="mb-4"
                [(ngModel)]="column.check"
                nz-checkbox
                (ngModelChange)="onClickCheckBox(column)"
                >{{ column.keyTitle | translate }}</label
              >
              <br />
            </ng-container>
          </div>
        </nz-dropdown-menu>
      </button>
    </nz-col>
  </nz-row>
  <nz-row>
    <nz-col nzSpan="24">
      <nz-table
        nzBordered
        [nzFrontPagination]="false"
        [nzShowPagination]="false"
        [nzScroll]="{ x: 'auto' }"
        [nzData]="datas"
        #nzTable
        nzSize="small"
        class="w-100"
      >
        <thead>
          <tr>
            <ng-container *ngFor="let column of columns; let i = index">
              <ng-container *ngIf="column.check">
                <th
                  nz-resizable
                  [nzWidth]="column.width"
                  (nzResize)="onResize($event, i)"
                  [nzMaxWidth]="500"
                  [nzMinWidth]="100"
                  style="cursor: pointer"
                  (click)="customSortFunction(column.keyName)"
                >
                  <div class="editable-cell">
                    {{ column.keyTitle | translate }}
                    <nz-resize-handle nzDirection="right">
                      <div class="resize-trigger"></div>
                    </nz-resize-handle>
                  </div>
                  <span
                    *ngIf="countSort == 0"
                    style="
                      float: right;
                      position: absolute;
                      bottom: 12px;
                      right: 10px;
                      cursor: pointer;
                    "
                    nz-tooltip="Sắp xếp giảm dần"
                    nz-icon
                    nzType="swap"
                    [nzRotate]="90"
                    nzTheme="outline"
                  ></span>
                  <span
                    *ngIf="countSort > 0 && sortOrder == 'descend'"
                    style="
                      float: right;
                      position: absolute;
                      bottom: 12px;
                      right: 10px;
                      cursor: pointer;
                    "
                    nz-tooltip="Sắp xếp tăng dần"
                    nz-icon
                    nzType="arrow-down"
                    nzTheme="outline"
                  ></span>
                  <span
                    *ngIf="countSort > 0 && sortOrder == 'ascend'"
                    style="
                      float: right;
                      position: absolute;
                      bottom: 12px;
                      right: 10px;
                      cursor: pointer;
                    "
                    nz-tooltip="Sắp xếp giảm dần"
                    nz-icon
                    nzType="arrow-up"
                    nzTheme="outline"
                  ></span>
                </th>
              </ng-container>
            </ng-container>
            <th nzWidth="100px" nzAlign="center" nzRight>
              {{ "table.action" | translate }}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <ng-container *ngFor="let column of columns">
              <ng-container *ngIf="column.check">
                <td
                  *ngIf="
                    column.keyName !== 'emailType' &&
                    column.keyName !== 'status'
                  "
                >
                  <nz-input-group
                    nzSearch
                    [nzPrefix]="prefixgdnCode"
                    [nzSuffix]="suffixgdnCode"
                  >
                    <input
                      type="text"
                      nz-input
                      [(ngModel)]="dataFilter[column.keyName]"
                      (keyup)="enterSearch($event)"
                    />
                  </nz-input-group>
                  <ng-template #prefixgdnCode>
                    <span
                      (click)="search()"
                      class="search-click"
                      style="color: #d9d9d9"
                      nz-icon
                      nzType="search"
                    ></span>
                  </ng-template>
                  <ng-template #suffixgdnCode>
                    <span
                      nz-icon
                      class="ant-input-clear-icon"
                      nzTheme="fill"
                      nzType="close-circle"
                      *ngIf="dataFilter[column.keyName]"
                      (click)="clear(column)"
                    ></span>
                  </ng-template>
                </td>
                <td *ngIf="column.keyName == 'emailType'">
                  <nz-select
                    class="select-search"
                    style="width: 100%"
                    [nzAllowClear]="true"
                    nzPlaceHolder="{{ 'all_select' | translate }}"
                    [(ngModel)]="dataFilter[column.keyName]"
                    (ngModelChange)="search()"
                  >
                    <nz-option
                      *ngFor="let item of listEmailType"
                      [nzValue]="item.value"
                      [nzLabel]="item.label"
                    ></nz-option>
                  </nz-select>
                </td>
                <td *ngIf="column.keyName == 'status'">
                  <nz-select
                    class="select-search"
                    style="width: 100%"
                    [nzAllowClear]="true"
                    nzPlaceHolder="{{ 'all_select' | translate }}"
                    [(ngModel)]="dataFilter[column.keyName]"
                    (ngModelChange)="search()"
                  >
                    <nz-option
                      *ngFor="let item of listStatus"
                      [nzValue]="item.value"
                      [nzLabel]="item.text"
                    ></nz-option>
                  </nz-select>
                </td>
              </ng-container>
            </ng-container>
            <td nzRight></td>
          </tr>
          <ng-container *ngFor="let row of nzTable.data; let i = index">
            <tr>
              <ng-container *ngFor="let column of columns; let j = index">
                <ng-container *ngIf="column.check">
                  <td
                    *ngIf="
                      column.keyName !== 'status' &&
                      column.keyName !== 'emailType'
                    "
                  >
                    {{ row[column.keyName] }}
                  </td>
                  <td *ngIf="column.keyName == 'emailType'">
                    <ng-container *ngFor="let item of listEmailType">
                      <ng-container *ngIf="row['emailType'] == item.value">
                        {{ item.label }}
                      </ng-container>
                    </ng-container>
                  </td>
                  <td nzAlign="center" *ngIf="column.keyName === 'status'">
                    <div [ngSwitch]="row['status']">
                      <div
                        class="border-element bordered-element__status_9"
                        *ngSwitchCase="'0'"
                      >
                        Đã tắt thông báo
                      </div>
                      <div
                        class="border-element bordered-element__status_1"
                        *ngSwitchCase="'1'"
                      >
                        Đã bật thông báo
                      </div>
                    </div>
                  </td>
                </ng-container>
              </ng-container>
              <td nzAlign="center">
                <div class="d-flex j-content-center">
                  <div class="w-32px">
                    <app-button
                      [iconType]="'info-circle'"
                      [iconTheme]="'fill'"
                      [buttonType]="'text'"
                      nz-tooltip="Xem thông tin cấu hình email nhận thông báo"
                      (btnClick)="onHandleView(row)"
                    ></app-button>
                  </div>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </nz-table>
    </nz-col>
  </nz-row>
  <nz-row *ngIf="total" nzGutter="24" nzAlign="middle" nzJustify="center">
    <div nz-col nzSpan="24">
      <app-pagination
        [currentPage]="page"
        [currentSize]="per_page"
        [total]="total"
        (emitPage)="pagination($event)"
      ></app-pagination>
    </div>
  </nz-row>
</div>

<nz-modal
  nzWidth="1000px"
  [(nzVisible)]="visible"
  [nzFooter]="null"
  (nzOnCancel)="onHandleCancel()"
  [nzContent]="showContent"
  [nzTitle]="showTitle"
>
  <ng-template #showTitle>
    <div class="d-flex">
      <img src="./assets/image/modalInfor.svg" alt="" />
      <h2 class="m-0 ml-24">
        {{ "Thông tin cấu hình email nhận thông báo" | translate }}
      </h2>
    </div>
  </ng-template>
  <ng-template #showContent>
    <app-update-email
      [idEmail]="currentData"
      (cancel)="visible = $event; getList()"
    ></app-update-email>
  </ng-template>
</nz-modal>
