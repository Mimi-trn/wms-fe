<!-- Danh sách kiện hanngf -->
<div style="display: block; border: 1px solid #ddd" class="common-bg">
  <nz-row
    nzAlign="middle"
    nzJustify="space-between"
    nzGutter="12"
    class="mb-12"
  >
    <nz-col>
      <h2 class="m-0">{{ "sidebar.location.list" | translate }}</h2>
    </nz-col>
    <nz-col class="d-flex" *ngIf="!isView">
      <app-button
        [title]="'Thêm mới vị trí'"
        [buttonType]="'text'"
        [iconType]="'plus-circle'"
        [iconTheme]="'outline'"
        (btnClick)="onHandleCreateNew()"
      ></app-button>
      <!-- <button nz-button nzType="text" class="p-0" nz-tooltip nz-dropdown [nzDropdownMenu]="configColumns">
        <img src="./assets/image/addColumn.svg" alt="">
        <nz-dropdown-menu #configColumns="nzDropdownMenu">
          <div style="
              background-color: white;
              padding: 8px 12px;
              border: 1px solid #ccc;
            ">
            <ng-container>
              <label nz-checkbox [(ngModel)]="allChecked" (ngModelChange)="updateAllChecked()"
                [nzIndeterminate]="indeterminate">
                Tất cả
              </label>
              <br />
            </ng-container>
            <ng-container *ngFor="let column of columns; let i = index">
              <label [(ngModel)]="column.check" nz-checkbox (ngModelChange)="onClickCheckBox()"
                style="margin-top: 8px">{{
                column.keyTitle
                | translate }}</label>
              <br />
            </ng-container>
          </div>
        </nz-dropdown-menu>
      </button> -->
    </nz-col>
  </nz-row>
  <nz-table
    nzBordered
    [nzFrontPagination]="false"
    [nzShowPagination]="false"
    [nzScroll]="{ x: 'auto', y: '400px' }"
    [nzData]="listLocationPackage"
    #table
    nzSize="small"
  >
    <thead>
      <tr>
        <th nzWidth="50px" nzAlign="center">STT</th>
        <ng-container *ngFor="let column of columns; let i = index">
          <ng-container *ngIf="column.check">
            <th
              nz-resizable
              [nzWidth]="column.width"
              (nzResize)="onResize($event, i)"
              [nzMaxWidth]="500"
              [nzMinWidth]="100"
              nzAlign="center"
            >
              <div class="editable-cell">
                {{ column.keyTitle | translate }}
                <nz-resize-handle nzDirection="right">
                  <div class="resize-trigger"></div>
                </nz-resize-handle>
              </div>
            </th>
          </ng-container>
        </ng-container>
        <th nzWidth="100px" nzAlign="center" *ngIf="!isView">
          {{ "table.action" | translate }}
        </th>
      </tr>
    </thead>
    <tbody [class]="listLocationPackage.length > 0 ? 'striped-tr' : ''">
      <tr>
        <td></td>
        <td></td>
        <ng-container *ngFor="let column of columns; let i = index">
          <ng-container *ngIf="column.check">
            <td *ngIf="column.keyName == 'locationCode'">
              <!-- <nz-input-group
                nzSearch
                [nzPrefix]="prefixlocationCode"
                [nzSuffix]="suffixlocationCode"
                (keyup)="enterSearch($event)"
              >
                <input
                  type="text"
                  nz-input
                  [(ngModel)]="dataFilter.locationCode"
                />
              </nz-input-group>
              <ng-template #prefixlocationCode>
                <span
                  (click)="filterData()"
                  class="search-click"
                  style="color: #d9d9d9"
                  nz-icon
                  nzType="search"
                ></span>
              </ng-template>
              <ng-template #suffixlocationCode>
                <span
                  nz-icon
                  class="ant-input-clear-icon"
                  nzTheme="fill"
                  nzType="close-circle"
                  *ngIf="dataFilter.locationCode"
                  (click)="dataFilter.locationCode = ''"
                ></span>
              </ng-template> -->
            </td>
            <td *ngIf="column.keyName == 'locationName'">
              <!-- <nz-input-group
                nzSearch
                [nzPrefix]="prefixlocationName"
                [nzSuffix]="suffixlocationName"
                (keyup)="enterSearch($event)"
              >
                <input
                  type="text"
                  nz-input
                  [(ngModel)]="dataFilter.locationName"
                />
              </nz-input-group>
              <ng-template #prefixlocationName>
                <span
                  (click)="filterData()"
                  class="search-click"
                  style="color: #d9d9d9"
                  nz-icon
                  nzType="search"
                ></span>
              </ng-template>
              <ng-template #suffixlocationName>
                <span
                  nz-icon
                  class="ant-input-clear-icon"
                  nzTheme="fill"
                  nzType="close-circle"
                  *ngIf="dataFilter.locationName"
                  (click)="dataFilter.locationName = ''"
                ></span>
              </ng-template> -->
            </td>
            <td nzAlign="right" *ngIf="column.keyName == 'packageQuantity'">
              <b>{{ countPackageQuantity | number }}</b>
            </td>
          </ng-container>
        </ng-container>
        <td *ngIf="!isView"></td>
      </tr>
      <ng-container *ngFor="let row of table.data; let i = index">
        <tr>
          <td nzAlign="center">{{ i + 1 }}</td>
          <ng-container *ngFor="let column of columns; let j = index">
            <ng-container *ngIf="column.check">
              <td
                *ngIf="
                  column.keyName !== 'locationCode' &&
                  column.keyName !== 'packageQuantity'
                "
              >
                {{ row[column.keyName] }}
              </td>

              <td *ngIf="column.keyName == 'locationCode'">
                {{ isView ? row["locationCode"] : "" }}
                <nz-input-group [nzSuffix]="arrowDown" *ngIf="!isView">
                  <input
                    nz-input
                    [(ngModel)]="row.locationCode"
                    nz-popover
                    [(nzPopoverVisible)]="row.visible"
                    (nzPopoverVisibleChange)="changeLocation($event, row)"
                    nzPopoverTrigger="click"
                    [nzPopoverContent]="contentTemplateLocation"
                    (click)="onHandleOpenLocation(row)"
                  />
                </nz-input-group>
                <ng-container *ngIf="!row.locationCode">
                  <span class="error-span">Bạn phải chọn mã vị trí</span>
                </ng-container>
                <ng-template #arrowDown>
                  <span
                    style="color: #d9d9d9; font-size: 12px"
                    nz-icon
                    nzType="down"
                  ></span>
                </ng-template>
                <ng-template #contentTemplateLocation>
                  <nz-table
                    style="width: 600px"
                    nzBordered
                    [nzFrontPagination]="false"
                    [nzShowPagination]="false"
                    [nzScroll]="{ x: 'auto' }"
                    [nzData]="listLocationFromBE"
                    #tableLocation
                    nzSize="small"
                  >
                    <thead>
                      <tr>
                        <th nzAlign="center">
                          {{ "sidebar.location.warehouse" | translate }}
                        </th>
                        <th nzAlign="center">
                          {{ "sidebar.location.code" | translate }}
                        </th>
                        <th nzAlign="center">
                          {{ "sidebar.location.name" | translate }}
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <ng-container
                        *ngFor="let rowLocation of tableLocation.data"
                      >
                        <tr
                          (click)="onHandleChooseLocation(row, rowLocation)"
                          style="cursor: pointer"
                        >
                          <td>{{ rowLocation["locationWarehouseName"] }}</td>
                          <td>{{ rowLocation["locationCode"] }}</td>
                          <td>{{ rowLocation["locationName"] }}</td>
                        </tr>
                      </ng-container>
                    </tbody>
                  </nz-table>
                  <nz-row
                    *ngIf="totalLocation"
                    nzGutter="24"
                    nzAlign="middle"
                    nzJustify="center"
                    class="mt-12"
                  >
                    <div nz-col nzSpan="24">
                      <app-pagination
                        [currentPage]="pageLocation"
                        [currentSize]="perPageLocation"
                        [total]="totalLocation"
                        (emitPage)="paginationLocation($event)"
                      ></app-pagination>
                    </div>
                  </nz-row>
                </ng-template>
              </td>
              <td *ngIf="column.keyName == 'packageQuantity'" nzAlign="right">
                {{ isView ? row["packageQuantity"] : "" }}
                <input
                  *ngIf="!isView"
                  type="number"
                  nz-input
                  [(ngModel)]="row['packageQuantity']"
                  (ngModelChange)="onHandlePackageQuantity(row)"
                />
              </td>
            </ng-container>
          </ng-container>
          <td *ngIf="!isView">
            <div class="d-flex a-items-center j-content-center" *ngIf="!isView">
              <a
                nz-popconfirm
                [nzPopconfirmTitle]="'modal.hintTitleFull' | translate"
                nzPopconfirmPlacement="topRight"
                [nzOkText]="'modal.yes' | translate"
                [nzCancelText]="'modal.no' | translate"
                (nzOnConfirm)="onHandleDelete(row)"
              >
                <app-button
                  [iconTheme]="'fill'"
                  [iconType]="'delete'"
                  [buttonType]="'text'"
                >
                </app-button>
              </a>
            </div>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </nz-table>
  <!-- <nz-row
    *ngIf="total"
    nzGutter="24"
    nzAlign="middle"
    nzJustify="center"
    class="mt-12"
  >
    <div nz-col nzSpan="24">
      <app-pagination
        [currentPage]="page"
        [currentSize]="per_page"
        [total]="total"
        (emitPage)="pagination($event)"
      ></app-pagination>
    </div>
  </nz-row> -->
</div>

<nz-modal
  nzWidth="1200px"
  [(nzVisible)]="visibleCreate"
  [nzFooter]="null"
  (nzOnCancel)="onHandleCancelCreate()"
  [nzContent]="showContentCreate"
  [nzTitle]="showTitleCreate"
>
  <ng-template #showTitleCreate>
    <div class="d-flex">
      <img src="./assets/image/modalInfor.svg" alt="" />
      <h2 class="m-0 ml-24">
        {{ "sidebar.location.create" | translate }}
      </h2>
    </div>
  </ng-template>
  <ng-template #showContentCreate>
    <app-create-location
      [product]="productFromParent"
      (childOut)="hide($event)"
    ></app-create-location>
  </ng-template>
</nz-modal>
