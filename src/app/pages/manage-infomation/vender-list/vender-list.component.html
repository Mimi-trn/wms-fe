<nz-row nzAlign="middle" class="mb-12">
    <app-breadcrumb [listBreadCrumb]="breadcrumbs"></app-breadcrumb>
</nz-row>
<div class="common-bg">
    <nz-row nzJustify="center" class="mb-12">
        <h2 class="m-0">
            {{ "Danh sách nhà cung cấp" | translate }}
        </h2>
    </nz-row>
    <nz-row class="mb-12">
        <nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24" nzXXl="24">
            <h4 class="m-0">{{ "search.general" | translate }}</h4>
        </nz-col>
        <nz-col nzXs="24" nzSm="24" nzMd="14" nzLg="12" nzXl="10" nzXXl="6">
            <form (ngSubmit)="onHandleSearchCommon()">
                <nz-input-group [nzPrefix]="prefixButtonSearch" [nzSuffix]="suffixButtonClear">
                    <input type="text" nz-input placeholder="{{ 'search.general.placeholder' | translate }}"
                        [(ngModel)]="searchGeneral" name="searchGeneral" />
                </nz-input-group>
                <ng-template #prefixButtonSearch>
                    <span class="search-click" style="color: #d9d9d9" nz-icon nzType="search"
                        (click)="onHandleSearchCommon()"></span>
                </ng-template>
                <ng-template #suffixButtonClear>
                    <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                        *ngIf="searchGeneral" (click)="searchGeneral = ''"></span>
                </ng-template>
            </form>
        </nz-col>

    </nz-row>
    <nz-row nzAlign="middle" nzJustify="end" nzGutter="12" class="mb-12">
        <nz-col>
            <app-button [title]="'add.new'" [buttonType]="'text'" [iconType]="'plus-circle'" [iconTheme]="'outline'"
                [tooltipTitle]="'Thêm mới nhà cung cấp'" (btnClick)="onClickAddNew()">
            </app-button>

        </nz-col>
        <nz-col>
            <app-button [title]="'Xuất excel'" [buttonType]="'text'" [iconType]="'file-excel'" [iconTheme]="'outline'"
                [tooltipTitle]="'Xuất excel danh sách nhà cung cấp'" (btnClick)="showExport()">
            </app-button>
        </nz-col>
        <nz-col>
            <button nz-button nzType="text" class="p-0" nz-tooltip nz-popover [nzPopoverContent]="configColumns"
                nzPopoverPlacement="left">
                <img src="./../../../../assets/image/addColumn.svg" alt="" />
                <ng-template #configColumns>
                    <div>
                        <ng-container>
                            <label class="mb-4" nz-checkbox [(ngModel)]="allChecked"
                                (ngModelChange)="onHandleUpdateAllChecked()" [nzIndeterminate]="indeterminate">
                                Tất cả
                            </label>
                            <br />
                        </ng-container>
                        <ng-container *ngFor="let column of columns; let i = index">
                            <label class="mb-4" [(ngModel)]="column.check" nz-checkbox
                                (ngModelChange)="onHandleClickCheckBox()">{{
                                column.keyTitle | translate }}</label>
                            <br />
                        </ng-container>
                    </div>
                </ng-template>
            </button>
        </nz-col>
    </nz-row>
    <nz-row>
        <nz-col nzSpan="24">
            <nz-table class="w-100" nzBordered nzFrontPagination="false" nzShowPagination="false" nzSize="small"
                [nzData]="listWo" #dataWo [nzScroll]="{ x: 'auto' }">
                <thead>
                    <tr>
                        <!-- <th nzWidth="50px"></th> -->
                        <ng-container *ngFor="let column of columns; let i = index">
                            <ng-container *ngIf="column.check">
                                <th nz-resizable [nzWidth]="column.width" (nzResize)="onResize($event, i)"
                                    [nzMaxWidth]="500" [nzMinWidth]="100" style="cursor: pointer"
                                    (click)="customSortFunction(column)">
                                    <div class="editable-cell">
                                        {{ column.keyTitle | translate }}
                                        <nz-resize-handle nzDirection="right">
                                            <div class="resize-trigger"></div>
                                        </nz-resize-handle>
                                    </div>
                                    <span *ngIf="column.count == 0" style="
                      float: right;
                      position: absolute;
                      bottom: 12px;
                      right: 10px;
                      cursor: pointer;
                    " nz-tooltip="Sắp xếp giảm dần" nz-icon nzType="swap" [nzRotate]="90" nzTheme="outline"></span>
                                    <span *ngIf="column.count > 0 && column.sortOrder == 'DESC'" style="
                      float: right;
                      position: absolute;
                      bottom: 12px;
                      right: 10px;
                      cursor: pointer;
                    " nz-tooltip="Sắp xếp tăng dần" nz-icon nzType="arrow-down" nzTheme="outline"></span>
                                    <span *ngIf="column.count > 0 && column.sortOrder == 'ASC'" style="
                      float: right;
                      position: absolute;
                      bottom: 12px;
                      right: 10px;
                      cursor: pointer;
                    " nz-tooltip="Sắp xếp giảm dần" nz-icon nzType="arrow-up" nzTheme="outline"></span>
                                </th>
                            </ng-container>
                        </ng-container>
                        <th nzWidth="80px" nzAlign="center" nzRight>
                            {{ "table.action" | translate }}
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <!-- <td></td> -->
                        <ng-container *ngFor="let column of columns">
                            <ng-container>
                                <td>
                                    <nz-input-group nzSearch [nzPrefix]="prefixKeyName" [nzSuffix]="suffixKeyName">
                                        <input type="text" nz-input [(ngModel)]="filterWo[column.keyName]"
                                            (keyup)="onHandleEnterSearch($event)" />
                                    </nz-input-group>
                                    <ng-template #prefixKeyName>
                                        <span (click)="onHandleClickSearch()" class="search-click" nz-icon
                                            nzType="search" style="color: #d9d9d9"></span>
                                    </ng-template>
                                    <ng-template #suffixKeyName>
                                        <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                                            *ngIf="filterWo[column.keyName]"
                                            (click)="onHandleClearInput(column.keyName)"></span>
                                    </ng-template>
                                </td>
                            </ng-container>
                            <ng-container *ngIf="column.check && column.keyName == 'startDate'">
                                <td>
                                    <nz-range-picker [(ngModel)]="filterWo[column.keyName]"
                                        (ngModelChange)="onHandleClickSearch()" [nzPlaceHolder]="[
                      'start_date' | translate,
                      'end_date' | translate
                    ]"></nz-range-picker>
                                </td>
                            </ng-container>
                            <ng-container *ngIf="column.check && column.keyName == 'endDate'">
                                <td>
                                    <nz-range-picker [(ngModel)]="filterWo[column.keyName]"
                                        (ngModelChange)="onHandleClickSearch()" [nzPlaceHolder]="[
                      'start_date' | translate,
                      'end_date' | translate
                    ]"></nz-range-picker>
                                </td>
                            </ng-container>
                            <ng-container *ngIf="column.check && column.keyName == 'createdAt'">
                                <td>
                                    <nz-range-picker [(ngModel)]="filterWo[column.keyName]"
                                        (ngModelChange)="onHandleClickSearch()" [nzPlaceHolder]="[
                      'start_date' | translate,
                      'end_date' | translate
                    ]"></nz-range-picker>
                                </td>
                            </ng-container>
                            <ng-container *ngIf="column.check && column.keyName == 'updatedAt'">
                                <td>
                                    <nz-range-picker [(ngModel)]="filterWo[column.keyName]"
                                        (ngModelChange)="onHandleClickSearch()" [nzPlaceHolder]="[
                      'start_date' | translate,
                      'end_date' | translate
                    ]"></nz-range-picker>
                                </td>
                            </ng-container>

                        </ng-container>
                        <td nzRight></td>
                    </tr>
                    <ng-container *ngFor="let row of listWo">
                        <tr>

                            <ng-container *ngFor="let column of columns">
                                <ng-container>
                                    <td>
                                        {{ row[column.keyName] }}
                                    </td>
                                </ng-container>
                            </ng-container>
                            <td nzRight>
                                <div class="d-flex j-content-center a-items-center">
                                    <nz-col style="width: 32px">
                                        <app-button iconTheme="fill" iconType="delete" buttonType="text"
                                            tooltipTitle="Xóa nhà cung cấp nhà cung cấp"
                                            (btnClick)="onHandleDelete(row)">
                                        </app-button>
                                    </nz-col>
                                    <nz-col style="width: 32px">
                                        <app-button iconTheme="fill" iconType="edit" buttonType="text"
                                            tooltipTitle="Chỉnh sửa thông tin" (btnClick)="onClickEdit(row)">
                                        </app-button>
                                    </nz-col>

                                </div>
                            </td>
                        </tr>
                        <tr *ngIf="expandSet.has(row.id)" [nzExpand]="expandSet.has(row.id)">
                            <app-wo-child [wo]="row.id"></app-wo-child>
                        </tr>
                    </ng-container>
                </tbody>
            </nz-table>
        </nz-col>
    </nz-row>
    <nz-row *ngIf="total" nzGutter="24" nzAlign="middle" nzJustify="center">
        <div nz-col nzSpan="24">
            <app-pagination [currentPage]="page" [currentSize]="perPage" [total]="total"
                (emitPage)="onHandlePagination($event)"></app-pagination>
        </div>
    </nz-row>

    <ng-template #modalContent>
        <form [formGroup]="newWoForm" class="p-4" style="display:flex; flex-direction:column; gap:12px;">

            <input nz-input placeholder="Tên nhà cung cấp" formControlName="vendorName" />
            <input nz-input placeholder="Mã số thuế" formControlName="taxCode" />
            <input nz-input placeholder="Địa chỉ" formControlName="address" />
            <input nz-input placeholder="SĐT" formControlName="phone" />
            <input nz-input placeholder="Email" formControlName="email" />
            <input nz-input placeholder="Ghi chú" formControlName="note" />

            <div style="display:flex; justify-content:flex-end; gap:8px;">
                <button nz-button nzType="primary" (click)="createNewWo()">Lưu</button>
            </div>
        </form>
    </ng-template>

</div>