<nz-row nzAlign="middle" class="mb-12">
  <app-breadcrumb nz-col [nzSpan]="23" *ngIf="isBreadcrumb" [listBreadCrumb]="breadcrumbs"
    [isHidden]="isHidden"></app-breadcrumb>
</nz-row>
<div class="common-bg">
  <nz-row nzJustify="center" class="mb-12">
    <h2 class="m-0">{{ "sidebar.information.child.listPO" | translate }}</h2>
  </nz-row>
  <nz-row class="mb-12">
    <nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24" nzXXl="24">
      <h4 class="m-0">{{ "search.general" | translate }}</h4>
    </nz-col>
    <nz-col nzXs="24" nzSm="24" nzMd="14" nzLg="12" nzXl="10" nzXXl="6">
      <form (ngSubmit)="searchGeneralFunc()">
        <nz-input-group [nzPrefix]="prefixButtonSearch" [nzSuffix]="suffixButtonClear">
          <input type="text" nz-input placeholder="{{ 'search.general.placeholder' | translate }}"
            [(ngModel)]="searchGeneral" name="searchGeneral" />
        </nz-input-group>
        <ng-template #prefixButtonSearch>
          <span class="search-click" nz-icon nzType="search" style="color: #d9d9d9"
            (click)="searchGeneralFunc()"></span>
        </ng-template>
        <ng-template #suffixButtonClear>
          <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle" *ngIf="searchGeneral"
            (click)="searchGeneral = ''; searchGeneralFunc()"></span>
        </ng-template>
      </form>
    </nz-col>
  </nz-row>
  <nz-row nzAlign="middle" nzJustify="end" nzGutter="12" class="mb-12">
    <nz-col *ngIf="(checkIsRole('wms_po_create') || checkIsRole('FCIM_ADMIN')) && !checkGroupsInTokenKeeper">
      <nz-row nzJustify="end">
        <app-button [title]="'add.new'" [buttonType]="'text'" [iconType]="'plus-circle'" [iconTheme]="'outline'"
          [tooltipTitle]="'Thêm mới'" (btnClick)="onClickAddNew()"></app-button>
      </nz-row>
    </nz-col>
    
    <nz-col>
      <button nz-button nzType="text" class="p-0" nz-tooltip nz-dropdown [nzDropdownMenu]="configColumns">
        <svg width="32" height="32" viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M8.33325 25.668H18.9999V29.668H29.6666V15.0013H24.3333V9.66797H8.33325V25.668ZM21.6666 25.668H26.9999V27.0013H21.6666V25.668ZM21.6666 21.668H26.9999V23.0013H21.6666V21.668ZM21.6666 17.668H26.9999V19.0013H21.6666V17.668ZM10.9999 12.3346H21.6666V15.0013H18.9999V23.0013H10.9999V12.3346Z"
            fill="#FF7A00" />
          <rect x="0.5" y="0.5" width="37" height="37" rx="4.5" stroke="#FF7A00" stroke-opacity="0.6" />
        </svg>
        <nz-dropdown-menu #configColumns="nzDropdownMenu">
          <div style="
              background-color: white;
              padding: 8px 12px;
              border: 1px solid #ccc;
            ">
            <ng-container>
              <label nz-checkbox [(ngModel)]="allChecked" (ngModelChange)="updateAllChecked()"
                [nzIndeterminate]="indeterminate">
                Tất cả
              </label>
              <br />
            </ng-container>
            <ng-container *ngFor="let column of columns; let i = index">
              <label [(ngModel)]="column.check" nz-checkbox (ngModelChange)="onClickCheckBox(column)">{{ column.keyTitle
                | translate }}</label>
              <br />
            </ng-container>
          </div>
        </nz-dropdown-menu>
      </button>
    </nz-col>
  </nz-row>

  <nz-row>
    <nz-col nzSpan="24">
      <nz-table class="w-100" nzBordered [nzFrontPagination]="false" [nzShowPagination]="false"
        [nzScroll]="{ x: 'auto' }" [nzData]="datas" #warehouseTable nzSize="small" [nzPageSize]="page"
        [nzPageIndex]="per_page" (nzQueryParams)="onQueryParamsChange($event)">
        <thead>
          <tr>
            <ng-container *ngFor="let column of columns; let i = index">
              <ng-container *ngIf="column.check">
                
                <th nz-resizable [nzWidth]="column.width" (nzResize)="onResize($event, i)" [nzMaxWidth]="500"
                  [nzMinWidth]="100" style="cursor: pointer" (click)="customSortFunction(column)">
                  <div class="editable-cell">
                    {{ column.keyTitle | translate }}
                    <nz-resize-handle nzDirection="right">
                      <div class="resize-trigger"></div>
                    </nz-resize-handle>
                  </div>
                  <span *ngIf="column.count == 0" style="
                      float: right;
                      position: absolute;
                      bottom: 12px;
                      right: 10px;
                      cursor: pointer;
                    " nz-tooltip="Sắp xếp giảm dần" nz-icon nzType="swap" [nzRotate]="90" nzTheme="outline"></span>
                  <span *ngIf="column.count > 0 && column.sortOrder == 'descend'" style="
                      float: right;
                      position: absolute;
                      bottom: 12px;
                      right: 10px;
                      cursor: pointer;
                    " nz-tooltip="Sắp xếp tăng dần" nz-icon nzType="arrow-down" nzTheme="outline"></span>
                  <span *ngIf="column.count > 0 && column.sortOrder == 'ascend'" style="
                      float: right;
                      position: absolute;
                      bottom: 12px;
                      right: 10px;
                      cursor: pointer;
                    " nz-tooltip="Sắp xếp giảm dần" nz-icon nzType="arrow-up" nzTheme="outline"></span>
                </th>
              </ng-container>
            </ng-container>
            <th nzWidth="100px" nzAlign="center" nzRight>
              {{ "table.action" | translate }}
            </th>
          </tr>
        </thead>
        <tbody [class]="total == 0 ? '' : 'striped-tr'">
          <tr>
            <ng-container *ngFor="let column of columns">
              <ng-container *ngIf="column.check && column.keyName == 'poCode'">
                <td>
                  <nz-input-group nzSearch [nzPrefix]="prefixPoCode" [nzSuffix]="suffixPoCode">
                    <input type="text" nz-input [(ngModel)]="dataFilter.poCode" (keyup)="enterSearch($event)" />
                  </nz-input-group>
                  <ng-template #prefixPoCode>
                    <span (click)="search()" class="search-click" nz-icon nzType="search" style="color: #d9d9d9"></span>
                  </ng-template>
                  <ng-template #suffixPoCode>
                    <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                      *ngIf="dataFilter.poCode" (click)="dataFilter.poCode = ''; search()"></span>
                  </ng-template>
                </td>
              </ng-container>
              <ng-container *ngIf="column.check && column.keyName == 'note'">
                <td>
                  <nz-input-group nzSearch [nzPrefix]="prefixPoNote" [nzSuffix]="suffixPoNote">
                    <input type="text" nz-input [(ngModel)]="dataFilter.note" (keyup)="enterSearch($event)" />
                  </nz-input-group>
                  <ng-template #prefixPoNote>
                    <span (click)="search()" class="search-click" nz-icon nzType="search" style="color: #d9d9d9"></span>
                  </ng-template>
                  <ng-template #suffixPoNote>
                    <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                      *ngIf="dataFilter.note" (click)="dataFilter.note = ''; search()"></span>
                  </ng-template>
                </td>
              </ng-container>
              <ng-container *ngIf="column.check && column.keyName == 'vendorName'">
                <td>
                  <nz-input-group nzSearch [nzPrefix]="prefixPoNote" [nzSuffix]="suffixPoNote">
                    <input type="text" nz-input [(ngModel)]="dataFilter.note" (keyup)="enterSearch($event)" />
                  </nz-input-group>
                  <ng-template #prefixPoNote>
                    <span (click)="search()" class="search-click" nz-icon nzType="search" style="color: #d9d9d9"></span>
                  </ng-template>
                  <ng-template #suffixPoNote>
                    <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                      *ngIf="dataFilter.note" (click)="dataFilter.note = ''; search()"></span>
                  </ng-template>
                </td>
              </ng-container>
              <ng-container *ngIf="column.check && column.keyName == 'source'">
                <td>
                  <nz-select class="select-search" style="width: 100%" [nzAllowClear]="true" [nzBorderless]="true"
                    [(ngModel)]="dataFilter[column.keyName]" (ngModelChange)="search()"
                    nzPlaceHolder="{{ 'all_select' | translate }}">
                    <nz-option [nzValue]="1" nzLabel="Trong nước"></nz-option>
                    <nz-option [nzValue]="2" nzLabel="Quốc tế"></nz-option>
                  </nz-select>
                </td>
              </ng-container>

              <ng-container *ngIf="column.check && column.keyName == 'createdBy'">
                <td>
                  <nz-input-group nzSearch [nzPrefix]="prefixCreatedBy" [nzSuffix]="suffixCreatedBy">
                    <input type="text" nz-input [(ngModel)]="dataFilter.createdBy" (keyup)="enterSearch($event)" />
                  </nz-input-group>
                  <ng-template #prefixCreatedBy>
                    <span (click)="search()" class="search-click" nz-icon nzType="search" style="color: #d9d9d9"></span>
                  </ng-template>
                  <ng-template #suffixCreatedBy>
                    <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                      *ngIf="dataFilter.createdBy" (click)="dataFilter.createdBy = ''; search()"></span>
                  </ng-template>
                </td>
              </ng-container>
              <ng-container *ngIf="column.check && column.keyName == 'createdAt'">
                <td>
                  <nz-range-picker [(ngModel)]="dataFilter[column.keyName]" (ngModelChange)="rangeDate()"
                    [nzBorderless]="true" [nzPlaceHolder]="[
                      'start_date' | translate,
                      'end_date' | translate
                    ]"></nz-range-picker>
                </td>
              </ng-container>
              <ng-container *ngIf="column.check && column.keyName == 'updatedAt'">
                <td>
                  <nz-range-picker [(ngModel)]="dataFilter[column.keyName]" (ngModelChange)="rangeDate()"
                    [nzBorderless]="true" [nzPlaceHolder]="[
                      'start_date' | translate,
                      'end_date' | translate
                    ]"></nz-range-picker>
                </td>
              </ng-container>
              <ng-container *ngIf="column.check && column.keyName == 'deliveryAt'">
                <td>
                  <nz-range-picker [(ngModel)]="dataFilter[column.keyName]" (ngModelChange)="rangeDate()"
                    [nzBorderless]="true" [nzPlaceHolder]="[
                      'start_date' | translate,
                      'end_date' | translate
                    ]"></nz-range-picker>
                </td>
              </ng-container>
              <ng-container *ngIf="column.check && column.keyName == 'documentAt'">
                <td>
                  <nz-range-picker [(ngModel)]="dataFilter[column.keyName]" (ngModelChange)="rangeDate()"
                    [nzBorderless]="true" [nzPlaceHolder]="[
                      'start_date' | translate,
                      'end_date' | translate
                    ]"></nz-range-picker>
                </td>
              </ng-container>
              <ng-container *ngIf="column.check && column.keyName == 'status'">
                <td>
                  <nz-select class="select-search" style="width: 100%" [nzAllowClear]="true" [nzBorderless]="true"
                    nzPlaceHolder="{{ 'all_select' | translate }}" [(ngModel)]="dataFilter[column.keyName]"
                    (ngModelChange)="search()">
                    <nz-option [nzValue]="1" nzLabel="Đóng"></nz-option>
                    <nz-option [nzValue]="2" nzLabel="Mở"></nz-option>
                    <nz-option [nzValue]="0" nzLabel="Bản nháp"></nz-option>
                  </nz-select>
                </td>
              </ng-container>
            </ng-container>
            <td nzRight></td>
          </tr>
          <ng-container *ngFor="let row of warehouseTable.data; let i = index">
            <tr>
              <ng-container *ngFor="let column of columns; let j = index">
                <ng-container *ngIf="column.check">
                  <td *ngIf="
                      column.keyName !== 'source' &&
                      column.keyName !== 'status' &&
                      column.keyName !== 'deliveryAt' &&
                      column.keyName !== 'createdAt' &&
                      column.keyName !== 'updatedAt' &&
                      column.keyName !== 'documentAt'
                    ">
                    {{ row[column.keyName] }}
                  </td>
                  <td *ngIf="column.keyName == 'source'">
                    <ng-container *ngFor="let element of listSource">
                      <ng-container *ngIf="element.value == row['source']">
                        {{ element.text }}
                      </ng-container>
                    </ng-container>
                  </td>
                  <td *ngIf="column.keyName == 'deliveryAt'" nzAlign="right">
                    {{ row["deliveryAt"] | date : "dd/MM/yyyy" }}
                  </td>
                  <td *ngIf="column.keyName == 'createdAt'" nzAlign="right">
                    {{ row["createdAt"] | date : "dd/MM/yyyy" }}
                  </td>
                  <td *ngIf="column.keyName == 'updatedAt'" nzAlign="right">
                    {{ row["updatedAt"] | date : "dd/MM/yyyy" }}
                  </td>
                  <td *ngIf="column.keyName == 'documentAt'" nzAlign="right">
                    {{ row["documentAt"] | date : "dd/MM/yyyy" }}
                  </td>
                  <td nzAlign="center" *ngIf="column.keyName === 'status'">
                    <div [ngSwitch]="row[column.keyName]">
                      <div class="border-element bordered-element__status_1" *ngSwitchCase="1">
                        {{ "Đóng" | translate }}
                      </div>
                      <div class="border-element bordered-element__status_4" *ngSwitchCase="2">
                        {{ "Mở" | translate }}
                      </div>
                      <div class="border-element bordered-element__status_2" *ngSwitchCase="0">
                        {{ "Bản nháp" | translate }}
                      </div>
                    </div>
                  </td>
                </ng-container>
              </ng-container>
              <td nzRight>
                <div class="d-flex j-content-center a-items-center">
                  <nz-col style="width: 32px">
                    <app-button
                      *ngIf="(checkIsRole('wms_iqc_create') || checkIsRole('FCIM_ADMIN')) && row['status'] == 2"
                      [iconTheme]="'fill'" [iconType]="'plus-circle'" (btnClick)="onHandleNewIQC(row)" [nz-tooltip]="
                    !row['iqcCreated']
                    ? 'Tạo yêu cầu IQC'
                    : 'Đã tạo yêu cầu IQC'
                    " [buttonType]="'text'">
                      <!--                    [isDisable]="!row['iqcCreated'] ? false : true"-->

                    </app-button>
                  </nz-col>
                  <nz-col style="width: 32px">
                    <app-button [iconTheme]="'fill'" [iconType]="'info-circle'" (btnClick)="onHandleView(row)"
                      nz-tooltip="Xem chi tiết PO" [buttonType]="'text'">
                    </app-button>
                  </nz-col>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </nz-table>
    </nz-col>
  </nz-row>
  <nz-row *ngIf="total" nzGutter="24" nzAlign="middle" nzJustify="center" class="mt-12">
    <div nz-col nzSpan="24">
      <app-pagination [currentPage]="page" [currentSize]="per_page" [total]="total"
        (emitPage)="pagination($event)"></app-pagination>
    </div>
  </nz-row>
</div>